# LDAP

### Nmap

No credentials, see what can be pulled.

```
nmap -n -sV --script "ldap* and not brute" <IP>  
```

### ldapdomaindump&#x20;

```bash
ldapdomaindump -u security.local\\<User> -p '<Password>' ldap://<IP>
```

### ldapsearch

```
# Search for users
ldapsearch -x -h 10.10.10.182 -D '' -w '' -b "DC=cascade,DC=local" | grep userPrincipalName

# Search for users, cleanup and output to file
ldapsearch -x -h 10.10.10.182 -D '' -w '' -b "DC=cascade,DC=local" | grep userPrincipalName | sed 's/userPrincipalName: //' | sort > ADUsers.txt
```

![](<../../.gitbook/assets/image (2033) (1).png>)

### Crackmapexec

```bash
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host> --admin-count
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host>  --asreproast ASREPROAST
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host>  --groups
crackmapexec ldap'<IP> -u <User> -p <Password> --kdcHost <Host>  --kerberoasting KERBEROASTING
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host>  --password-not-required
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host>  --trusted-for-delegation
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host>  --users

# Modules
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host> -M get-desc-users
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host> -M laps
crackmapexec ldap <IP> -u <User> -p <Password> --kdcHost <Host> -M ldap-signing
```
