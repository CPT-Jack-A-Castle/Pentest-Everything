# Unconstrained Delegation

## Description

Delegation in Active Directory is the ability for an object such as a user or computer to impersonate another object.  Unconstrained Delegation is where we allow a particular object to be trusted for delegation where the object can impersonate other accounts.

![](<.gitbook/assets/image (2044).png>)

## Enumeration

The PowerShell Active Directory Module can be used to search for objects with the `TrustedForDelegation` property set to True.

```
Get-ADComputer -Filter {TrustedForDelegation -eq $true} -Properties trustedfordelegation,serviceprincipalname,description
```

![](<.gitbook/assets/image (2040).png>)

Above we can see that the computer object FileSRV01.Security.local has the TrustedForDelegation property set to True.

Running Mimikatz on the File Server FileSRV01 shows we have no Ticket Granting Ticket (TGT) for the Domain Administrator account.

```bash
# Mimikatz
privilege::debug
sekurlsa::tickets
```

![](<.gitbook/assets/image (2042).png>)

However, after applying the 'Trust this computer for delegation to any service' options in Active Directory we then access the file share on FileSRV01 as the Domain Administrator from a different device.

![](<.gitbook/assets/image (2038).png>)

After doing so we can run Mimikatz again and look at the stored Kerberos tickets. This time we see we have a stored ticket for the Domain Administrator

![](<.gitbook/assets/image (2037).png>)

This ticket can be exported with Mimikatz and reused to authenticate else where in the Domain.&#x20;

```
sekurlsa::tickets /export
```

![](<.gitbook/assets/Export Tickets.png>)

![](<.gitbook/assets/Dir as non DA.png>)

![](<.gitbook/assets/List of tickets in CWD.png>)

![](<.gitbook/assets/Loaded Admin Ticket.png>)

![](<.gitbook/assets/DC dir.png>)

## Exploitation





## References

{% embed url="https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1" %}

{% embed url="https://stealthbits.com/blog/unconstrained-delegation-permissions" %}

{% embed url="https://docs.microsoft.com/en-us/archive/blogs/autz_auth_stuff/kerberos-delegation" %}
